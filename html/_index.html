<!DOCTYPE HTML>
<!--
Made for 2021 CSP Create Project
I am not responsible for the content
posted by users of the website
-->
<html>
    <head>
        <title>CSP ChatRoom</title>
		<!--
		External Scripts
		JQuery: <https://jquery.com/>
		SocketIO: <https://socket.io/> (client side JS, not Node)
		-->
		<link rel="stylesheet" href="{{ url_for("static", filename="css/index.css") }}"><!--index.css for page stylesheet-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" 
                integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous">
        </script><!--JQuery-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" 
                integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous">
        </script><!--SocketIO-->
		<script src='{{ url_for("static", filename="js/index.js") }}'></script><!--index.js-->
    </head>
    <body class="">
        <table>
            <tr>
                <td>
                    <div class="sidebar" style="height: 766px; width: 270px;">
                        <h1 class="insidebar"><a href="https://www.gtsbr.org">Justus'</a> Imageboard</h1>
                        
                        <h3 class="insidebar" style="margin-top:0px;">Beta 12.6</h3>
                        
                        <table style="margin-left:12px;">
                            <tr>
                                <td>
                                    <button type="button" class="btn" onclick="location.href = '/login';" >Log In</button>
                                
                                </td>
                                <td>
                                    <button type="button" class="btn" onclick="location.href = '/signup';" >Sign Up</button>
                                </td>
                            </tr>
                        </table>
                        <br>
                        <!--<img style="margin:20px;" src='{{ url_for("static", filename="img/jesus.gif") }}' width="200px;">-->
                        <h3 class="insidebar" style="margin-top:0px; margin-bottom:0px;">Rules</h3> 
                        <p class="insidebar">
                            Usernames are baseless pseudonym's for users and <b>mean nothing. </b>
                            Please be kind to others! There are 0 forms of moderation <i>currently</i> besides the profanity filter. 
                            Admin is <b><i>not responsible</i></b> for any content posted by users!
                        </p>
                        <h3 class="insidebar" style="margin-top:0px; margin-bottom:0px;">Privacy Policy</h3> 
                        <p class="insidebar">
                            No information is saved or logged to a hard storage location. 
                            Images are not saved either. 
                            Everything is just handled during active server processing.
                            Subject to change for scalability and performance settings, probably with an updated rendering method.
                        </p>
                    </div>
                </td>
                <td>
                    <div class="mar" style="height: 180px; width: 1000px;"> 
                        <form action="" method="POST" id="sendForm"> 
                        <table>
                            <tr>
                                <td>Username: </td>
                                <td>
                                    <!--<div id="messageArea" form="sendForm" name="message" 
                                    class="textdiv message" rows="4" cols="50" contenteditable="true" 
                                    placeholder="Message..." onpaste="console.log('onpastefromhtml')" id="msbox"></div>-->
                                    <input type="text" class="username" placeholder="Username" maxlength="50" id="userbox"> 
                                </td>
                                <td>
                                    <h2>Send Message!</h2>
                                </td>
                                <td>
                                    <p></p>
                                </td>
                            </tr>
                            <tr>
                                <td>Message: </td>
                                <td>
                                    <textarea maxlength="100" 
                                    name="message" class="message" rows="4" cols="50" 
                                    form="sendForm" placeholder="Message..." 
                                    onpaste="console.log('onpastefromhtml')" id="msbox"></textarea>
                                    
                                    <!--<div id="messageArea" form="sendForm" name="message" 
                                    class="textdiv message" rows="4" cols="50" contenteditable="true" 
                                    placeholder="Message..." onpaste="console.log('onpastefromhtml')" id="msbox"></div>-->
                                        
                                    </div>



                                    <script>

                                        var PasteImage = function (el) {
                                          this._el = el;
                                          this._listenForPaste();
                                        };
                                  
                                        PasteImage.prototype._getURLObj = function () {
                                          return window.URL || window.webkitURL;
                                        };
                                  
                                        PasteImage.prototype._pasteImage = function (image) {
                                          this.emit('paste-image', image);
                                        };
                                  
                                        PasteImage.prototype._pasteImageSource = function (src) {
                                          var self = this,
                                            image = new Image();
                                  
                                          image.onload = function () {
                                            self._pasteImage(image);
                                          };
                                  
                                          image.src = src;
                                        };
                                  
                                        PasteImage.prototype._onPaste = function (e) {
                                  
                                          // We need to check if event.clipboardData is supported (Chrome & IE)
                                          if (e.clipboardData && e.clipboardData.items) {
                                  
                                            // Get the items from the clipboard
                                            var items = e.clipboardData.items;
                                  
                                            // Loop through all items, looking for any kind of image
                                            for (var i = 0; i < items.length; i++) {
                                              if (items[i].type.indexOf('image') !== -1) {
                                                // We need to represent the image as a file
                                                var blob = items[i].getAsFile();
                                  
                                                // Use a URL or webkitURL (whichever is available to the browser) to create a
                                                // temporary URL to the object
                                                var URLObj = this._getURLObj();
                                                var source = URLObj.createObjectURL(blob);
                                  
                                                // The URL can then be used as the source of an image
                                                this._pasteImageSource(source);
                                  
                                                // Prevent the image (or URL) from being pasted into the contenteditable element
                                                e.preventDefault();
                                              }
                                            }
                                          }
                                        };
                                  
                                        PasteImage.prototype._listenForPaste = function () {
                                          var self = this;
                                  
                                          self._origOnPaste = self._el.onpaste;
                                  
                                          self._el.addEventListener('paste', function (e) {
                                  
                                            self._onPaste(e);
                                  
                                            // Preserve an existing onpaste event handler
                                            if (self._origOnPaste) {
                                              self._origOnPaste.apply(this, arguments);
                                            }
                                  
                                          });
                                        };
                                  
                                        // TODO: use EventEmitter instead
                                        PasteImage.prototype.on = function (event, callback) {
                                          this._callback = callback;
                                        };
                                  
                                        // TODO: use EventEmitter instead
                                        PasteImage.prototype.emit = function (event, arg) {
                                          this._callback(arg);
                                        };
                                  
                                        // -----
                                  
                                        var pasteImage = new PasteImage(document.getElementById('messageArea'));
                                  
                                        pasteImage.on('paste-image', function (image) {
                                            src = image.getAttribute("src");
                                          document.getElementById('textareacont').innerHTML += `<img style="max-width: 50px; max-height: 50px;" src="${src}">`;
                                          console.log(src);
                                        });
                                  
                                      </script>
                                </td>
                                <td>
                                    <div style="padding-left: 10px;" class="btn-w upload-btn-wrapper">
                                        <input id="fileUpload" type='file' name="myfile" style="visibility: hidden;"/>
                                        <button type="button" class="btn" onclick="$('#fileUpload').click();" >Upload a file</button>
                                    </div>
                                    <div style="padding-left: 10px;" class="btn-w">
                                        <input type="submit" value="Send">
                                    </div>
                                    <div style="padding-left: 10px; width:80px;" class="btn-w">
                                        <code id="waitmsg"></code>
                                    </div>
                                </td>

                                <!--<td  id="textareacont">-->
                                <td>
                                </td>
                            </tr>
                        
                        </table>

                        
                        </form>
                    </div> 
                    <div class="" style="width: 1000px; height: 570px;">
                        <table class="mar msgtable"  id="messages"> 
                        </table>  
                        <p id="newmsg" style="margin-left:20px; margin-bottom:5px;"></p>
                    </div>
                </td>
            </tr>
        </table>
    </body>
</html>